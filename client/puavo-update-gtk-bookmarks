#!/bin/sh

set -eu

update_bookmarks() {
    local bookmarksdir
    local bookmarksfile
    local schooldir_displayname
    local sharename
    local tmpfile
    local userdir_displayname

    userdir_displayname=$1
    schooldir_displayname=$2
    sharename=$3
    bookmarksfile=$4

    bookmarksdir=$(dirname "${bookmarksfile}")
    mkdir -p "${bookmarksdir}"
    touch "${bookmarksfile}"

    tmpfile=$(mktemp)
    egrep -v '\.puavo-sharedir|^file:///home/share/' "${bookmarksfile}" >"${tmpfile}"

    case "$(cat /etc/puavo/hosttype)" in
        laptop)
            echo "file://${HOME}/.puavo-sharedir.userdir ${userdir_displayname}" >>"${tmpfile}"
            echo "file://${HOME}/.puavo-sharedir.schooldir/${sharename}/$(id -gn) ${schooldir_displayname}" >>"${tmpfile}"
            ;;
        *)
            echo "file:///home/share/${sharename}/$(id -gn) ${schooldir_displayname}" >>"${tmpfile}"
            ;;
    esac
    mv "${tmpfile}" "${bookmarksfile}"
}

case "$(echo $LANG | cut -c 1-2)" in
  fi)
    userdir_displayname='Verkkokansio'
    schooldir_displayname='Yhteiset'
    sharename='yhteiset'
    ;;
  sv)
    userdir_displayname='NÃ¤tverksmapp'
    schooldir_displayname='Delade Filer'
    sharename='delade_filer'
    ;;
  *)
    userdir_displayname='Network folder'
    schooldir_displayname='Share'
    sharename='share'
    ;;
esac

update_bookmarks "${userdir_displayname}" "${schooldir_displayname}" "${sharename}" "${HOME}/.gtk-bookmarks"
update_bookmarks "${userdir_displayname}" "${schooldir_displayname}" "${sharename}" "${HOME}/.config/gtk-3.0/bookmarks"
